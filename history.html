<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order History â€¢ Service App</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body {
  margin:0;
  font-family:'Poppins', sans-serif;
  background:#f3f5f7;
}

.header {
  background:#1c1f27;
  padding:18px 24px;
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.header-title {
  font-size:24px;
  font-weight:700;
}

.tabs {
  display:flex;
  justify-content:center;
  margin-top:20px;
  gap:20px;
}

.tab {
  padding:10px 20px;
  border-radius:20px;
  background:#e0e0e0;
  cursor:pointer;
  font-weight:600;
  transition:0.3s ease;
}

.tab.active {
  background:#1c1f27;
  color:white;
}

.orders-container {
  max-width:700px;
  margin:20px auto;
}

.order-card {
  background:white;
  padding:20px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
  transition:0.3s ease;
}

.order-card:hover {
  transform: translateY(-5px);
}

.order-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.order-service {
  font-weight:600;
  font-size:16px;
}

.order-status {
  padding:5px 10px;
  border-radius:12px;
  font-size:13px;
  font-weight:600;
  color:white;
}

.order-status.active { background:#f39c12; }
.order-status.completed { background:#27ae60; }

.order-details {
  font-size:14px;
  color:#555;
}

.go-service {
  margin-top:10px;
  display:inline-block;
  padding:8px 12px;
  background:#4e8cff;
  color:white;
  border-radius:8px;
  text-decoration:none;
  font-weight:600;
}

.go-service:hover {
  background:#356ac3;
}
</style>
</head>
<body>

<div class="header">
  <div class="header-title">Order History</div>
</div>

<div class="tabs">
  <div class="tab active" id="activeTab" onclick="showOrders('active')">Active Orders</div>
  <div class="tab" id="completedTab" onclick="showOrders('completed')">Completed Orders</div>
</div>

<div class="orders-container" id="ordersContainer">
  <!-- Orders will be dynamically loaded here -->
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCqEZrtD-qmYRriE_44kONWr-hZcGleb3g",
  authDomain: "services-2efa9.firebaseapp.com",
  databaseURL: "https://services-2efa9-default-rtdb.firebaseio.com",
  projectId: "services-2efa9",
  storageBucket: "services-2efa9.firebasestorage.app",
  messagingSenderId: "864899080004",
  appId: "1:864899080004:web:f2f3739413478e7e098111",
  measurementId: "G-3ESSBLPC05"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Check login
if(localStorage.getItem("loggedIn") !== "true"){
  window.location.href = "login.html";
}

const ordersContainer = document.getElementById("ordersContainer");
let ordersData = [];

// Fetch orders and listen for real-time updates
function loadOrders(){
  const phone = localStorage.getItem("phone");
  db.ref("orders").orderByChild("phone").equalTo(phone).on("value", snapshot=>{
    ordersData = [];
    snapshot.forEach(child=>{
      const order = child.val();
      ordersData.push({...order, id: child.key});
    });
    // Refresh the current tab view
    const activeTab = document.getElementById('activeTab').classList.contains('active') ? 'active' : 'completed';
    showOrders(activeTab);
  });
}

// Show orders based on status
function showOrders(status){
  // Switch active tab
  document.getElementById('activeTab').classList.remove('active');
  document.getElementById('completedTab').classList.remove('active');
  if(status==='active') document.getElementById('activeTab').classList.add('active');
  else document.getElementById('completedTab').classList.add('active');

  // Filter orders
  const filtered = ordersData.filter(o => o.status === status);

  // Render
  ordersContainer.innerHTML = '';
  if(filtered.length===0){
    ordersContainer.innerHTML = `<p style="text-align:center; color:#555; margin-top:20px;">No ${status} orders found.</p>`;
    return;
  }

  filtered.forEach(order=>{
    const div = document.createElement('div');
    div.className = 'order-card';
    div.innerHTML = `
      <div class="order-header">
        <div class="order-service">${order.service}</div>
        <div class="order-status ${status}">${status.charAt(0).toUpperCase()+status.slice(1)}</div>
      </div>
      <div class="order-details">
        <p><b>Issue:</b> ${order.issue}</p>
        <p><b>Time:</b> ${order.time}</p>
        <p><b>Address:</b> ${order.address}</p>
        <p><b>Date:</b> ${order.date || ''}</p>
      </div>
    `;
    ordersContainer.appendChild(div);
  });
}



loadOrders(); // initial load
</script>

</body>
</html>